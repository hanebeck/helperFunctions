# --------------------------------------------------------------------------------------------------
# Visualiation of smooting mixtures
# --------------------------------------------------------------------------------------------------
module myDensities
# --------------------------------------------------------------------------------------------------
# Includes
# --------------------------------------------------------------------------------------------------
#
# --------------------------------------------------------------------------------------------------
# Exports
# --------------------------------------------------------------------------------------------------
export G, GM, dGM, MomentsGauss, MomentsGM
# --------------------------------------------------------------------------------------------------
# Global definitions and constants
# --------------------------------------------------------------------------------------------------
#
# --------------------------------------------------------------------------------------------------
#
# Single Gaussian
#
G(x, μ, σ) = exp(-0.5 * (x - μ)^2 / σ^2) / (sqrt(2 * π) * σ)
# --------------------------------------------------------------------------------------------------
#
# Gaussian mixture
#
function GM(x, w, μ, σ)
    f = 0
    for i ∈ eachindex(w)
        fi = w[i] * G(x, μ[i], σ[i])
        f += fi
    end
    f
end
# --------------------------------------------------------------------------------------------------
#
# Derivative of Gaussian mixture
#
function dGM(x, w, μ, σ)
    f = 0
    for i ∈ eachindex(w)
        fi = w[i] * G(x, μ[i], σ[i]) * (μ[i] - x) / σ[i]^2
        f += fi
    end
    f
end
# --------------------------------------------------------------------------------------------------
#
# Moments of scalar Gaussian
#
function MomentsGauss(μ::T, σ::T) where {T}
    M = Vector{T}(undef, 11)
    M[1] = 1
    M[2] = μ
    M[3] = μ^2 + σ^2
    M[4] = μ^3 + 3 * μ * σ^2
    M[5] = μ^4 + 6 * μ^2 * σ^2 + 3 * σ^4
    M[6] = μ^5 + 10 * μ^3 * σ^2 + 15 * μ * σ^4
    M[7] = μ^6 + 15 * μ^4 * σ^2 + 45 * μ^2 * σ^4 + 15 * σ^6
    M[8] = μ^7 + 21 * μ^5 * σ^2 + 105 * μ^3 * σ^4 + 105 * μ * σ^6
    M[9] = μ^8 + 28 * μ^6 * σ^2 + 210 * μ^4 * σ^4 + 420 * μ^2 * σ^6 + 105 * σ^8
    M[10] = μ^9 + 36 * μ^7 * σ^2 + 378 * μ^5 * σ^4 + 1260 * μ^3 * σ^6 + 945 * μ * σ^8
    M[11] = μ^10 + 45 * μ^8 * σ^2 + 630 * μ^6 * σ^4 + 3150 * μ^4 * σ^6 + 4725 * μ^2 * σ^8 + 945 * σ^10
    M
end
# --------------------------------------------------------------------------------------------------
#
# Moments of scalar Gaussian mixture
#
function MomentsGM(w::Vector{T}, μ::Vector{T}, σ::Vector{T}) where {T}
    M = zeros(T, 11)
    for i ∈ eachindex(w)
        M .+= w[i] * MomentsGauss(μ[i], σ[i])
    end
    M
end
# --------------------------------------------------------------------------------------------------
end#module